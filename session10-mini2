import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report
from sklearn.preprocessing import LabelEncoder


# Restaurant Customer Dataset 
data = {
    "Orders_Per_Month": [2, 8, 5, 1, 10, 3, 7, 4],
    "Avg_Bill": [200, 600, 450, 150, 700, 250, 500, 300],
    "Discount_Usage": [0, 1, 1, 0, 1, 0, 1, 0],
    "Preferred_Menu": ["Snacks", "Biryani", "Pizza", "Snacks",
                       "Biryani", "Snacks", "Pizza", "Pizza"],
    "Reorder": ["No", "Yes", "Yes", "No", "Yes", "No", "Yes", "No"]
}

df = pd.DataFrame(data)


# Encode Categorical Columns
le_menu = LabelEncoder()
df["Preferred_Menu"] = le_menu.fit_transform(df["Preferred_Menu"])

df["Reorder"] = df["Reorder"].map({
    "No": 0,
    "Yes": 1
})


# Features and Target
X = df[["Orders_Per_Month", "Avg_Bill", "Discount_Usage", "Preferred_Menu"]]
y = df["Reorder"]


# Train-Test Split
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.25, random_state=42
)


# Decision Tree Model
dt_model = DecisionTreeClassifier(
    max_depth=3,
    random_state=42
)

dt_model.fit(X_train, y_train)
dt_pred = dt_model.predict(X_test)

print("DECISION TREE RESULTS")
print("Accuracy:", accuracy_score(y_test, dt_pred))
print("Confusion Matrix:\n", confusion_matrix(y_test, dt_pred))
print("Classification Report:\n", classification_report(y_test, dt_pred))


# Random Forest Model
rf_model = RandomForestClassifier(
    n_estimators=100,
    max_depth=4,
    random_state=42
)

rf_model.fit(X_train, y_train)
rf_pred = rf_model.predict(X_test)

print("\nRANDOM FOREST RESULTS")
print("Accuracy:", accuracy_score(y_test, rf_pred))
print("Confusion Matrix:\n", confusion_matrix(y_test, rf_pred))
print("Classification Report:\n", classification_report(y_test, rf_pred))


# Feature Importance
print("\nFEATURE IMPORTANCE (Random Forest)")
for feature, importance in zip(X.columns, rf_model.feature_importances_):
    print(feature, ":", importance)


# Prediction Example
new_customer = [[6, 400, 1, le_menu.transform(["Pizza"])[0]]]
prediction = rf_model.predict(new_customer)

print("\nNEW CUSTOMER PREDICTION")
print("Will Reorder?:", "Yes" if prediction[0] == 1 else "No")
